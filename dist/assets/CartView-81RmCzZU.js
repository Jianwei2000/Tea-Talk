import{r,u as I,o as R,e as h,a as S,d,f as $,w,g as t,j as A,F as k,k as M,h as g,t as c,i as C,z as B,l as i,b as j,c as u}from"./index-De0Ru6L5.js";import{S as l}from"./sweetalert2.all-wg-7VLTu.js";const O=t("div",{class:"loader-container"},[t("div",{class:"loader"}),t("div",{class:"text-white text-center fs-4 mt-2"},"喝杯熱茶，稍等片刻 ~ ~")],-1),z={class:"container my-8"},E=t("div",{class:"row my-3 text-center fs-6"},[t("div",{class:"col-4 text-primary fw-bold"},"1.購物清單"),t("div",{class:"col-4 text-muted"},"2.填寫資料"),t("div",{class:"col-4 text-muted"},"3.完成訂單")],-1),G=t("div",{class:"progress"},[t("div",{class:"progress-bar bg-primary",role:"progressbar","aria-valuemin":"0","aria-valuemax":"100"})],-1),H={key:0,class:"text-center my-7"},J=t("h2",{class:"text-muted my-4"},"尚無購物清單紀錄",-1),K=t("p",{class:"h4 text-muted my-4"},"趕快前往商品頁面，將喜歡的商品加到購物車吧！",-1),Q={key:1,class:"row mt-5"},W={class:"col-md-8"},X={class:"border"},Y={class:"table align-middle text-center table-striped table-hover mb-4"},Z=t("thead",null,[t("tr",{class:"table-warning"},[t("th",{style:{}}),t("th",{class:"d-none d-md-table-cell"},"圖片"),t("th",{class:"d-none d-sm-table-cell"},"商品名稱"),t("th",{class:"d-md-none"},"品名"),t("th",{class:"d-sm-table-cell"},"單價"),t("th",{style:{"min-width":"55px",width:"120px"}},"數量"),t("th",null,"小計")])],-1),tt=["onClick"],et=t("i",{class:"bi bi-trash3-fill"},null,-1),ot=[et],st={class:"d-none d-md-block"},nt=["src","alt"],at={class:"input-group input-group-sm"},lt=["onUpdate:modelValue","onChange"],rt={class:"d-flex justify-content-end"},ct={class:"col-md-4 mt-4 mt-md-0"},it={class:"border shadow p-3"},dt={class:"p-4"},ut={class:"text-muted fs-6 d-flex justify-content-between"},pt={class:"text-muted fs-6 d-flex justify-content-between mt-2"},ht={class:"fw-bold text-primary fs-4 d-flex justify-content-between border-top border-2 pt-3 mt-3"},ft={class:"fs-4"},vt={class:"input-group my-3"},gt={__name:"CartView",setup(mt){const f=r(!1),T=r(0);function V(e){T.value=e}const y=I(),N=r([]),n=r({carts:[]});function a(){f.value=!0,i.get("https://vue3-course-api.hexschool.io/v2/api/kjwapi/cart").then(e=>{n.value=e.data.data,f.value=!1}).catch(e=>{console.error(e.response)})}function L(e){i.delete(`https://vue3-course-api.hexschool.io/v2/api/kjwapi/cart/${e}`).then(()=>{a(),h.emit("get-cart"),l.fire({position:"top-end",icon:"success",title:"已刪除",showConfirmButton:!1,timer:1e3})}).catch(o=>{l.fire({icon:"error",title:"錯誤",text:o.response.data.message}),console.error("錯誤訊息:",o.response)})}function U(){l.fire({title:"是否要清除?",icon:"warning",confirmButtonText:"確定",confirmButtonColor:"#464C3A",showCancelButton:!0,cancelButtonText:"取消",cancelButtonColor:"#F75000",reverseButtons:!0}).then(e=>{e.isConfirmed&&i.delete("https://vue3-course-api.hexschool.io/v2/api/kjwapi/carts").then(()=>{a(),h.emit("get-cart")}).catch(o=>{l.fire({icon:"error",title:"錯誤",text:o.response.data.message}),console.error("錯誤訊息:",o.response)})})}const v=r("");function q(e){v.value=e.id,console.log("Updating cart item:",e);const o=`https://vue3-course-api.hexschool.io/v2/api/kjwapi/cart/${e.id}`,_={product_id:e.product_id,qty:e.qty};i.put(o,{data:_}).then(()=>{a(),v.value=""}).catch(p=>{l.fire({icon:"error",title:"錯誤",text:p.response.data.message}),console.error("錯誤訊息:",p.response),v.value=""})}function P(){i.get("https://vue3-course-api.hexschool.io/v2/api/kjwapi/products/all").then(e=>{N.value=e.data.products}).catch(e=>{console.error(e.response)})}function D(){y.push("/checkorder")}const m=r("");function F(){i.post("https://vue3-course-api.hexschool.io/v2/api/kjwapi/coupon",{data:{code:m.value}}).then(e=>{n.value.carts.final_total=e.data.final_total,l.fire({icon:"success",title:"已套用優惠",showConfirmButton:!1,timer:1500}),a()}).catch(e=>{l.fire({icon:"error",title:"請輸入正確的優惠碼",text:e.response.data.message,showConfirmButton:!1,timer:2e3}),console.error(e.response)})}return R(()=>{let e=0;const o=setInterval(()=>{e>=15?clearInterval(o):(e+=5,V(e))},50);P(),a(),h.on("get-cart",a)}),S(()=>{h.off("get-cart",a)}),(e,o)=>{var x;const _=j("VLoading"),p=j("RouterLink");return u(),d(k,null,[$(_,{active:f.value},{default:w(()=>[O]),_:1},8,["active"]),t("div",z,[E,G,((x=n.value.carts)==null?void 0:x.length)===0?(u(),d("div",H,[J,K,t("div",{class:"btn btn-primary btn-lg my-4",onClick:o[0]||(o[0]=s=>A(y).push("/products"))},"前往選購")])):(u(),d("div",Q,[t("div",W,[t("div",X,[t("table",Y,[Z,t("tbody",null,[(u(!0),d(k,null,M(n.value.carts,s=>(u(),d("tr",{key:s.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger border-0 p-1",onClick:b=>L(s.id)},ot,8,tt)]),t("td",st,[$(p,{to:`/product/${s.product.id}`},{default:w(()=>[t("img",{src:s.product.imageUrl,class:"img-cart rounded-3",alt:s.title},null,8,nt)]),_:2},1032,["to"])]),t("td",null,c(s.product.title),1),t("td",null,"NT$ "+c(e.$filters.currency(s.product.price)),1),t("td",null,[t("div",at,[C(t("input",{min:"1",type:"number",class:"form-control text-center","onUpdate:modelValue":b=>s.qty=b,onChange:b=>q(s)},null,40,lt),[[B,s.qty,void 0,{number:!0}]])])]),t("td",null,"NT$ "+c(e.$filters.currency(s.total)),1)]))),128))])]),t("div",rt,[t("button",{class:"mb-4 btn btn-dark rounded-0 me-4",onClick:o[1]||(o[1]=s=>U())}," 清除購物清單 ")])])]),t("div",ct,[t("div",it,[t("ul",dt,[t("li",ut,[g(" 小計 "),t("span",null," NT$ "+c(e.$filters.currency(n.value.total)),1)]),t("li",pt,[g(" 優惠碼 "),t("span",null,"-NT$ "+c(e.$filters.currency(n.value.total-n.value.final_total)),1)]),t("li",ht,[g(" 總計 "),t("span",ft,"NT$ "+c(e.$filters.currency(n.value.final_total)),1)])]),t("div",vt,[C(t("input",{type:"text",class:"form-control fs-7 rounded-0 border border-2 border-muted","onUpdate:modelValue":o[2]||(o[2]=s=>m.value=s),placeholder:"輸入優惠碼"},null,512),[[B,m.value]]),t("button",{class:"btn btn-primary fs-6 rounded-0",type:"button",onClick:F}," 套用 ")]),t("button",{type:"button",to:"/checkOrder",class:"btn btn-outline-danger w-100 fs-5 my-4",onClick:o[3]||(o[3]=s=>D())}," 前往結帳 ")])])]))])],64)}}};export{gt as default};
